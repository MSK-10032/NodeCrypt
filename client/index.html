<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Secure Chat - BA4IHR</title>
	<link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/body.css">
	<link rel="stylesheet" href="css/phone.css">
	<link rel="stylesheet" href="css/form-animation.css">
	<link rel="stylesheet" href="css/dark-mode.css">
	<meta name="description" content="NodeCrypt - True end-to-end encrypted chat system, no database, all messages encrypted locally, ...">
	<meta name="keywords" content="BA4IHR, BA4IHR Chat">
	<meta name="author" content="shuaiplus">
	<meta property="og:title" content="NodeCrypt - End-to-End Encrypted Chat System">
	<meta property="og:description" content="NodeCrypt is a zero-knowledge, end-to-end encrypted open source chat system where all encryption and decryption is done locally on the client side...">
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://github.com/shuaiplus/NodeCrypt">
	<meta property="og:image" content="assets/favicon.svg">
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="NodeCrypt - End-to-End Encrypted Chat System">
	<meta name="twitter:description" content="NodeCrypt is a zero-knowledge, end-to-end encrypted open source chat system where all encryption and decryption is done locally on the client side...">
	<meta name="twitter:image" content="assets/favicon.svg">
	<meta name="theme-color" content="#071019" id="meta-theme-color" />
	<style>
		/* 添加一个预加载样式，避免闪烁 */
		.preload * {
			-webkit-transition: none !important;
			-moz-transition: none !important;
			-ms-transition: none !important;
			-o-transition: none !important;
			transition: none !important;
		}
		:root {
  /* 提供一组主题变量（深色） */
  --bg: #071019;
  --panel-bg: #0b1217;
  --surface: #0f1820;
  --muted: #9fb0c6;
  --text: #e6eef6;
  --accent: #3aa0ff;
  --border: rgba(255,255,255,0.06);
  --input-bg: rgba(255,255,255,0.03);
  --bubble-sent: #07364a;
  --bubble-recv: #0a1a24;
  --danger: #ff6b6b;
  --success: #5fe28a;
  --glass: rgba(255,255,255,0.02);
  --shadow: 0 6px 18px rgba(0,0,0,0.6);
}

/* 仅在 body 有 .dark 时启用（保证可切换） */
body.dark {
  background-color: var(--bg) !important;
  color: var(--text) !important;
}

/* 基础元素覆盖 */
body.dark, body.dark .main, body.dark .sidebar, body.dark .rightbar, body.dark .settings-sidebar {
  background-color: transparent;
  color: var(--text);
}

/* 标准容器 */
body.dark .container, body.dark .main, body.dark .sidebar, body.dark .rightbar {
  background: linear-gradient(180deg, var(--panel-bg), var(--surface));
}

/* 卡片 / 面板 */
body.dark .flip-card, body.dark .flip-card-inner, body.dark .flip-card-front, body.dark .flip-card-back {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid var(--border);
  color: var(--text);
}

/* 按钮 */
body.dark button, body.dark .help-btn, body.dark .settings-btn, body.dark .send-message-btn {
  background: var(--glass);
  color: var(--text);
  border: 1px solid rgba(255,255,255,0.03);
}
body.dark button:hover {
  background: rgba(255,255,255,0.035);
}

/* 输入框 */
body.dark input, body.dark textarea, body.dark .input-message-input {
  background: var(--input-bg);
  color: var(--text);
  border: 1px solid rgba(255,255,255,0.03);
}

/* 消息气泡 */
body.dark .msg-bubble.sent {
  background: var(--bubble-sent);
  color: var(--text);
}
body.dark .msg-bubble.recv {
  background: var(--bubble-recv);
  color: var(--text);
}

/* 侧边栏、用户信息 */
body.dark .sidebar-user, body.dark .rooms, body.dark .join-room {
  background: transparent;
  color: var(--text);
}

/* 链接与强调色 */
body.dark a {
  color: var(--accent);
}

/* 小图标颜色适配 */
body.dark svg path, body.dark svg circle {
  fill: currentColor;
  stroke: currentColor;
}

/* 设置面板 */
body.dark .settings-sidebar {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-left: 1px solid var(--border);
}

/* 小屏适配遮罩 */
body.dark .mobile-sidebar-mask, body.dark .mobile-rightbar-mask {
  background: rgba(0,0,0,0.6);
}

/* 轻微阴影 */
body.dark .card {
  box-shadow: var(--shadow);
}

/* 按钮（主题切换图标） */
.theme-toggle-btn {
  background: transparent;
  border: none;
  color: var(--muted);
  cursor: pointer;
  padding: 6px;
  margin-left: 8px;
  border-radius: 6px;
}
.theme-toggle-btn:hover {
  color: var(--text);
  background: rgba(255,255,255,0.02);
}

/* 防止深色模式下的图片边框可见 */
body.dark img {
  filter: none;
}

/* 兼容 prefers-color-scheme：仍然尊重用户系统偏好，除非用户手动切换 */
@media (prefers-color-scheme: dark) {
  /* 若未主动切换，浏览器会默认走 dark 变量；这里作为补充（主要由 JS 管理） */
}
	</style>
</head>
<body class="preload dark">
	<div class="login-container" id="login-container">
		<!-- 翻转卡片容器 -->
		<div class="flip-card" id="flip-card">
			<div class="flip-card-inner">
				<!-- 卡片正面 - 登录表单 -->
				<div class="flip-card-front">
					<!-- 帮助按钮 -->
					<button class="help-btn" id="help-btn" type="button" data-i18n-title="help.usage_guide">
						<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
							<circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
							<path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							<circle cx="12" cy="17" r="1" fill="currentColor"/>
						</svg>
					</button>
					<h1 id="login-title"></h1>
					<form id="login-form">
						<!-- 登录表单内容将由JavaScript动态生成 -->
					</form>
				</div>
				<!-- 卡片背面 - 使用说明 -->
				<div class="flip-card-back">
					<button class="help-btn back-btn" id="back-btn" type="button" data-i18n-title="help.back_to_login">
						<svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
							<path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					</button>
					<h2 data-i18n="help.usage_guide"></h2>
					<div class="help-content">
						<div class="help-section">
							<h3 data-i18n="help.what_is_nodecrypt"></h3>
							<p data-i18n="help.what_is_nodecrypt_desc"></p>
						</div>
						<div class="help-section">
							<h3 data-i18n="help.how_to_start"></h3>
							<ol>
								<li>
									<strong data-i18n="help.step_username"></strong>：
									<span data-i18n="help.step_username_desc"></span>
								</li>
								<li>
									<strong data-i18n="help.step_node_name"></strong>：
									<span data-i18n="help.step_node_name_desc"></span>
								</li>
								<li>
									<strong data-i18n="help.step_password"></strong>：
									<span data-i18n="help.step_password_desc"></span>
								</li>
								<li>
									<strong data-i18n="help.step_join"></strong>：
									<span data-i18n="help.step_join_desc"></span>
								</li>
							</ol>
							<div class="help-important">
								<strong data-i18n="help.important_note"></strong>：<span data-i18n="help.room_isolation_note"></span>
							</div>
						</div>
						<div class="help-section">
							<h3 data-i18n="help.security_features"></h3>
							<ul>
								<li><strong data-i18n="help.e2e_encryption"></strong>：<span data-i18n="help.e2e_encryption_desc"></span></li>
								<li><strong data-i18n="help.password_enhanced_encryption"></strong>：<span data-i18n="help.password_enhanced_encryption_desc"></span></li>
								<li><strong data-i18n="help.no_history"></strong>：<span data-i18n="help.no_history_desc"></span></li>
								<li><strong data-i18n="help.anonymous_communication"></strong>：<span data-i18n="help.anonymous_communication_desc"></span></li>
								<li><strong data-i18n="help.decentralized"></strong>：<span data-i18n="help.decentralized_desc"></span></li>
							</ul>
						</div>
						<div class="help-section">
							<h3 data-i18n="help.usage_tips"></h3>
							<ul>
								<li><strong data-i18n="help.tip_private_chat"></strong>：<span data-i18n="help.tip_private_chat_desc"></span></li>
								<li><strong data-i18n="help.tip_group_chat"></strong>：<span data-i18n="help.tip_group_chat_desc"></span></li>
								<li><strong data-i18n="help.tip_security_reminder"></strong>：<span data-i18n="help.tip_security_reminder_desc"></span></li>
								<li><strong data-i18n="help.tip_password_strategy"></strong>：<span data-i18n="help.tip_password_strategy_desc"></span></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="powered-by">
			Powered by <a href="https://github.com/shuaiplus/NodeCrypt" target="_blank" rel="noopener">NodeCrypt</a>
			&copy; 2025 by <a href="https://github.com/shuaiplus" target="_blank" rel="noopener">@shuaiplus</a>
		</div>
	</div>

	<div class="container" id="chat-container" style="display:none;">
		<div class="mobile-sidebar-mask" id="mobile-sidebar-mask"></div>
		<div class="mobile-rightbar-mask" id="mobile-rightbar-mask"></div>

		<!-- Settings panel as a sidebar replacement -->
		<div class="settings-sidebar" id="settings-sidebar" style="display:none;">
			<div class="settings-header">
				<button class="settings-back-btn" id="settings-back-btn" title="" aria-label="">
					<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
						<path d="M15 18L9 12L15 6" stroke="#808080" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
				</button>
				<h2 class="settings-title" id="settings-title"></h2>
			</div>
			<div class="settings-content" id="settings-content">
				<!-- Settings content will be populated by JavaScript -->
			</div>
		</div>

		<div class="sidebar" id="sidebar">
			<div class="sidebar-user">
				<span class="avatar" id="sidebar-user-avatar"></span>
				<span class="sidebar-username" id="sidebar-username"></span>

				<!-- 主题切换按钮（保留） -->
				<button class="theme-toggle-btn" id="theme-toggle-btn" title="切换主题" aria-label="切换主题">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" id="theme-icon" aria-hidden="true">
						<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" fill="currentColor"/>
					</svg>
				</button>

				<!-- 精简且合法的设置图标（替换掉原来被截断的长 SVG） -->
				<button class="settings-btn" id="settings-btn" title="" aria-label="">
					<svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
						<path fill="currentColor" d="M12 8.6A3.4 3.4 0 1012 15.4 3.4 3.4 0 0012 8.6zm8.2 2.4l-1.4-.2a7.9 7.9 0 00-.6-1.5l.8-1.1-1.6-1.6-1.1.8a7.9 7.9 0 00-1.5-.6l-.2-1.4H9.8l-.2 1.4a7.9 7.9 0 00-1.5.6l-1.1-.8L5.4 9l.8 1.1c-.3.5-.5 1-.6 1.5l-1.4.2v2.4l1.4.2c.1.6.3 1.1.6 1.6l-.8 1.1 1.6 1.6 1.1-.8c.5.3 1 .5 1.5.6l.2 1.4h2.4l.2-1.4c.6-.1 1.1-.3 1.6-.6l1.1.8L19 18.7l-.8-1.1c.3-.5.5-1 .6-1.6l1.4-.2v-2.4z"/>
					</svg>
				</button>
			</div>

			<div class="join-room">
				<svg class="MuiSvgIcon-root icon-22-middle" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
					<path d="M21 3.01H3a2 2 0 00-2 2V9h2V4.99h18v14.03H3V15H1v4.01a2 2 0 002 1.98h18a2 2 0 002-1.98v-14a2 2 0 00-2-2zM11 16l4-4-4-4v3H1v2h10v3z" fill="currentColor"/>
				</svg>
				<span id="join-room-text"></span>
			</div>

			<div class="rooms" id="room-list"></div>
		</div>

		<div class="main">
			<div class="main-header" id="main-header"></div>
			<div class="chat-area" id="chat-area"></div>

			<div class="chat-input-area">
				<div class="rows-wrapper chat-input-wrapper chat-input-main-wrapper chat-rows-wrapper">
					<div class="new-message-wrapper rows-wrapper-row" data-offset="commands">
						<button class="chat-emoji-btn" type="button" aria-hidden="true">
							<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
								<path d="M12 2a10 10 0 100 20 10 10 0 000-20zm-3.5 8a1.5 1.5 0 11.001-3.001A1.5 1.5 0 018.5 10zm7 7a5 5 0 01-10 0h10z" />
							</svg>
						</button>

						<div class="input-message-container">
							<div class="input-message-input is-empty scrollable scrollable-y no-scrollbar input-message-input-init" contenteditable="true" dir="auto" tabindex="-1"></div>
							<span class="input-field-placeholder" aria-hidden="true"></span>
							<div contenteditable="true" tabindex="-1" class="input-message-input is-empty scrollable scrollable-y no-scrollbar input-field-input-fake"></div>
							<button class="chat-attach-btn" type="button" aria-hidden="true">
								<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
									<path d="M21.44 11.05l-8.49 8.49a5 5 0 01-7.07-7.07l8.49-8.49a3.5 3.5 0 114.95 4.95L10.83 17.9a1 1 0 01-1.41-1.41l8.49-8.49" />
								</svg>
							</button>
						</div>

						<input type="file" multiple class="input-hidden" />
					</div>
				</div>

				<div class="send-message-btn">
					<span class="text">
						<svg viewBox="0 0 16 16" class="bi bi-send-fill" height="22" width="22" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
							<path d="M15.964.686a.5.5 0 00-.65-.65L.767 5.855l-.452.18a.5.5 0 00-.082.887l.41.26 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 00.886-.083L15.964.686z" fill="currentColor"/>
						</svg>
					</span>
				</div>
			</div>
		</div>

		<div class="rightbar" id="rightbar">
			<div class="rightbar-header">
				<div class="rightbar-group">
					<div class="group-info">
						<div class="title" id="members-title"></div>
						<div class="group-desc" id="rightbar-group-desc"></div>
					</div>
				</div>
			</div>
			<div class="rightbar-tabs tabs" id="member-tabs"></div>
			<div class="members" id="member-list"></div>
		</div>
	</div>

	<script type="module" src="./js/theme.js" onload></script>
	<script type="module" src="./js/main.js" onload></script>
</body>
</html>
